import { useState, useEffect } from "react"
import { CustomFetch } from "../api/customFeth.js"
import Swal from "sweetalert2"

export const TodasSolicitudes = ({ reqCine }) => {
    const [requestTienda, setRequestCine] = useState([]);

    const rejectedRequest = async (e) => {
        try {
            await CustomFetch(`http://localhost:3000/solicitarTienda/${e.target.id}`, 'DELETE');
            const dataCine = await CustomFetch('http://localhost:3000/solicitarTienda', 'GET');

            console.log("datacine", dataCine )
            console.log("response", response )

            setRequestCine(dataCine);
            Swal.fire({
                title: 'Solicitud rechazada',
                icon: 'error',
                confirmButtonText: 'Ok',
                width: '50%',
                padding: '1rem',
                background: '#DBCBCB',
                grow: 'row'
            });
        } catch (error) {
            console.error('Error rejecting request:', error);
        }
    };

    const acceptRequest = async (e) => {
        try {
            const response = await CustomFetch(`http://localhost:3000/solicitarTienda/${e.target.id}`, 'GET');
            const dataCine = await CustomFetch('http://localhost:3000/solicitarTienda', 'GET');

            console.log("datacine", dataCine )
            console.log("response", response )

            setRequestCine(dataCine);
            Swal.fire({
                title: 'Solicitud aceptada',
                icon: 'success',
                confirmButtonText: 'Ok',
                width: '50%',
                padding: '1rem',
                background: '#DBCBCB',
                grow: 'row'
            });
        } catch (error) {
            console.error('Error accepting request:', error);
        }
    };

    useEffect(() => {
        setRequestCine(reqCine);
    }, [reqCine]);

    return (
        <div>
      {/* <Header/> */}
      {/* <button onClick={fetchData}>aqui</button> */}
    {requestTienda && requestTienda.map((tienda) => (
      <div key={tienda.id}>
        <p>ID: {tienda.id}</p>
        <p>Nombre de la tienda: {tienda.name_tienda}</p>
        <p>Cuit: {tienda.cuit}</p>
        <p>Cuit: {tienda.cuit}</p>
        <p>Telefono: {tienda.phone}</p>
        <p>Provincia: {tienda.province.name} </p>
        <p>Departamento: {tienda.location.name} </p>
        <p>Direccion: {tienda.address} </p>
        <div className="d-flex justify-content-end">
            <div className="">
                <button id={tienda.id} onClick={acceptRequest} className="requestsButton btn btn-success">Aceptar</button>
             </div>
            <div className="">
                <button onClick={rejectedRequest}
                 id={tienda.id} className="requestsButton  btn btn-danger">Rechazar</button>
            </div>
        </div>

        <hr/>
      </div>
    ))}
    </div>
    )
}